<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G·ª£i √ù C·∫£m ∆†n & Xin L·ªói</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out;
        }
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCRwXwZ9sNFGBmY1Z4U1warH_xByWqC9fY",
            authDomain: "lime-camon-xinloi.firebaseapp.com",
            projectId: "lime-camon-xinloi",
            storageBucket: "lime-camon-xinloi.firebasestorage.app",
            messagingSenderId: "559164064502",
            appId: "1:559164064502:web:39902bfd2488bea5e9a2d7",
            measurementId: "G-HBCL2526ML"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        function App() {
            const [activeTab, setActiveTab] = useState('thank');
            const [currentSuggestion, setCurrentSuggestion] = useState('');
            const [showAdmin, setShowAdmin] = useState(false);
            const [isAdminAuthenticated, setIsAdminAuthenticated] = useState(false);
            const [password, setPassword] = useState('');
            const [showPasswordDialog, setShowPasswordDialog] = useState(false);
            const [newSuggestion, setNewSuggestion] = useState('');
            const [loading, setLoading] = useState(true);
            const [saving, setSaving] = useState(false);
            const [error, setError] = useState('');
            const [suggestions, setSuggestions] = useState({ thank: [], sorry: [] });
            
            const ADMIN_PASSWORD = 'limecuoinam';

            useEffect(() => {
                loadSuggestions();
            }, []);

            const loadSuggestions = async () => {
                try {
                    setLoading(true);
                    setError('');
                    
                    const doc = await db.collection('suggestions').doc('data').get();
                    
                    if (doc.exists) {
                        setSuggestions(doc.data());
                    } else {
                        await db.collection('suggestions').doc('data').set({
                            thank: [],
                            sorry: []
                        });
                        setSuggestions({ thank: [], sorry: [] });
                    }
                } catch (err) {
                    console.error('Error loading:', err);
                    setError('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i.');
                } finally {
                    setLoading(false);
                }
            };

            const saveSuggestions = async (updatedSuggestions) => {
                try {
                    setSaving(true);
                    setError('');
                    
                    await db.collection('suggestions').doc('data').set(updatedSuggestions);
                    
                } catch (err) {
                    console.error('Error saving:', err);
                    setError('Kh√¥ng th·ªÉ l∆∞u d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i.');
                } finally {
                    setSaving(false);
                }
            };

            const getRandomSuggestion = () => {
                const list = suggestions[activeTab];
                if (list.length === 0) {
                    setCurrentSuggestion('Ch∆∞a c√≥ g·ª£i √Ω n√†o. Vui l√≤ng th√™m g·ª£i √Ω trong tab Admin.');
                    return;
                }
                const randomIndex = Math.floor(Math.random() * list.length);
                setCurrentSuggestion(list[randomIndex]);
            };

            const addSuggestion = async () => {
                if (newSuggestion.trim()) {
                    const lines = newSuggestion.split('\n').map(line => line.trim()).filter(line => line);
                    const updatedList = [...suggestions[activeTab], ...lines];
                    const updatedSuggestions = { ...suggestions, [activeTab]: updatedList };
                    setSuggestions(updatedSuggestions);
                    await saveSuggestions(updatedSuggestions);
                    setNewSuggestion('');
                }
            };

            const deleteSuggestion = async (index) => {
                const updatedList = suggestions[activeTab].filter((_, i) => i !== index);
                const updatedSuggestions = { ...suggestions, [activeTab]: updatedList };
                setSuggestions(updatedSuggestions);
                await saveSuggestions(updatedSuggestions);
            };

            const handleAdminClick = () => {
                if (isAdminAuthenticated) {
                    setShowAdmin(!showAdmin);
                } else {
                    setShowPasswordDialog(true);
                }
            };

            const handlePasswordSubmit = (e) => {
                e.preventDefault();
                if (password === ADMIN_PASSWORD) {
                    setIsAdminAuthenticated(true);
                    setShowAdmin(true);
                    setShowPasswordDialog(false);
                    setPassword('');
                    setError('');
                } else {
                    setError('M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!');
                    setPassword('');
                }
            };

            const handleLogout = () => {
                setIsAdminAuthenticated(false);
                setShowAdmin(false);
                setPassword('');
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-100 via-pink-50 to-blue-100 flex items-center justify-center">
                        <div className="text-center">
                            <div className="spinner mx-auto mb-4"></div>
                            <p className="text-gray-600 text-lg">ƒêang t·∫£i d·ªØ li·ªáu...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-100 via-pink-50 to-blue-100 p-4 md:p-8">
                    <div className="max-w-2xl mx-auto">
                        {/* Header */}
                        <div className="flex justify-between items-center mb-8">
                            <h1 className="text-3xl md:text-4xl font-bold text-gray-800">
                                üíù G·ª£i √ù Ch√¢n Th√†nh
                            </h1>
                            <button
                                onClick={handleAdminClick}
                                className="p-3 bg-white rounded-lg shadow-md hover:shadow-lg transition-all"
                            >
                                <svg className="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                            </button>
                        </div>

                        {/* Password Dialog */}
                        {showPasswordDialog && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full animate-fade-in">
                                    <h2 className="text-2xl font-bold mb-4 text-gray-800">
                                        üîê ƒêƒÉng Nh·∫≠p Admin
                                    </h2>
                                    <form onSubmit={handlePasswordSubmit}>
                                        <div className="mb-6">
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                M·∫≠t kh·∫©u
                                            </label>
                                            <input
                                                type="password"
                                                value={password}
                                                onChange={(e) => setPassword(e.target.value)}
                                                placeholder="Nh·∫≠p m·∫≠t kh·∫©u admin"
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                autoFocus
                                            />
                                        </div>
                                        <div className="flex gap-3">
                                            <button
                                                type="submit"
                                                className="flex-1 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all font-semibold"
                                            >
                                                ƒêƒÉng Nh·∫≠p
                                            </button>
                                            <button
                                                type="button"
                                                onClick={() => {
                                                    setShowPasswordDialog(false);
                                                    setPassword('');
                                                    setError('');
                                                }}
                                                className="flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all font-semibold"
                                            >
                                                H·ªßy
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        )}

                        {/* Error Message */}
                        {error && (
                            <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex items-start gap-3">
                                <svg className="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <div>
                                    <p className="text-red-800 font-medium">L·ªói</p>
                                    <p className="text-red-600 text-sm">{error}</p>
                                </div>
                            </div>
                        )}

                        {/* Saving Indicator */}
                        {saving && (
                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 text-center">
                                <p className="text-blue-800">ƒêang l∆∞u...</p>
                            </div>
                        )}

                        {!showAdmin ? (
                            // User View
                            <>
                                {/* Tabs */}
                                <div className="flex gap-4 mb-8">
                                    <button
                                        onClick={() => {
                                            setActiveTab('thank');
                                            setCurrentSuggestion('');
                                        }}
                                        className={`flex-1 py-4 px-6 rounded-lg font-semibold text-lg transition-all ${
                                            activeTab === 'thank'
                                                ? 'bg-gradient-to-r from-green-400 to-blue-500 text-white shadow-lg transform scale-105'
                                                : 'bg-white text-gray-600 hover:bg-gray-50'
                                        }`}
                                    >
                                        üôè C·∫£m ∆†n
                                    </button>
                                    <button
                                        onClick={() => {
                                            setActiveTab('sorry');
                                            setCurrentSuggestion('');
                                        }}
                                        className={`flex-1 py-4 px-6 rounded-lg font-semibold text-lg transition-all ${
                                            activeTab === 'sorry'
                                                ? 'bg-gradient-to-r from-pink-400 to-purple-500 text-white shadow-lg transform scale-105'
                                                : 'bg-white text-gray-600 hover:bg-gray-50'
                                        }`}
                                    >
                                        üôá Xin L·ªói
                                    </button>
                                </div>

                                {/* Random Button */}
                                <div className="bg-white rounded-xl shadow-xl p-8 mb-6">
                                    <button
                                        onClick={getRandomSuggestion}
                                        className={`w-full py-4 px-6 rounded-lg font-semibold text-lg text-white flex items-center justify-center gap-3 transition-all hover:scale-105 ${
                                            activeTab === 'thank'
                                                ? 'bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600'
                                                : 'bg-gradient-to-r from-pink-400 to-purple-500 hover:from-pink-500 hover:to-purple-600'
                                        }`}
                                    >
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                        </svg>
                                        Random G·ª£i √ù
                                    </button>
                                </div>

                                {/* Suggestion Display */}
                                {currentSuggestion && (
                                    <div className="bg-white rounded-xl shadow-xl p-8 animate-fade-in">
                                        <div className={`text-center p-6 rounded-lg ${
                                            activeTab === 'thank' 
                                                ? 'bg-gradient-to-r from-green-50 to-blue-50' 
                                                : 'bg-gradient-to-r from-pink-50 to-purple-50'
                                        }`}>
                                            <p className="text-xl md:text-2xl text-gray-800 leading-relaxed">
                                                "{currentSuggestion}"
                                            </p>
                                        </div>
                                        <p className="text-center text-gray-500 mt-4 text-sm">
                                            Nh·∫•n Random ƒë·ªÉ xem g·ª£i √Ω kh√°c
                                        </p>
                                    </div>
                                )}

                                {/* Instructions */}
                                {!currentSuggestion && (
                                    <div className="text-center text-gray-600 p-8">
                                        <p className="text-lg">
                                            üëÜ Nh·∫•n n√∫t "Random G·ª£i √ù" ƒë·ªÉ nh·∫≠n c√¢u g·ª£i √Ω
                                        </p>
                                    </div>
                                )}
                            </>
                        ) : (
                            // Admin View
                            <div className="bg-white rounded-xl shadow-xl p-6 md:p-8">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">
                                        ‚öôÔ∏è Qu·∫£n L√Ω G·ª£i √ù
                                    </h2>
                                    <button
                                        onClick={handleLogout}
                                        className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-all text-sm font-semibold flex items-center gap-2"
                                    >
                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                        </svg>
                                        ƒêƒÉng Xu·∫•t
                                    </button>
                                </div>

                                {/* Admin Tabs */}
                                <div className="flex gap-4 mb-6">
                                    <button
                                        onClick={() => setActiveTab('thank')}
                                        className={`flex-1 py-3 px-4 rounded-lg font-semibold transition-all ${
                                            activeTab === 'thank'
                                                ? 'bg-green-500 text-white'
                                                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                        }`}
                                    >
                                        üôè C·∫£m ∆†n ({suggestions.thank.length})
                                    </button>
                                    <button
                                        onClick={() => setActiveTab('sorry')}
                                        className={`flex-1 py-3 px-4 rounded-lg font-semibold transition-all ${
                                            activeTab === 'sorry'
                                                ? 'bg-pink-500 text-white'
                                                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                        }`}
                                    >
                                        üôá Xin L·ªói ({suggestions.sorry.length})
                                    </button>
                                </div>

                                {/* Add New Suggestion */}
                                <div className="mb-6">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Th√™m g·ª£i √Ω m·ªõi (m·ªói d√≤ng l√† m·ªôt g·ª£i √Ω)
                                    </label>
                                    <div className="flex flex-col gap-2">
                                        <textarea
                                            value={newSuggestion}
                                            onChange={(e) => setNewSuggestion(e.target.value)}
                                            placeholder={"Nh·∫≠p n·ªôi dung g·ª£i √Ω...\nM·ªói d√≤ng s·∫Ω l√† m·ªôt g·ª£i √Ω ri√™ng\n\nV√≠ d·ª•:\nC·∫£m ∆°n b·∫°n r·∫•t nhi·ªÅu\nC·∫£m ∆°n v√¨ s·ª± gi√∫p ƒë·ª°"}
                                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-y"
                                            rows="5"
                                            disabled={saving}
                                        />
                                        <button
                                            onClick={addSuggestion}
                                            disabled={saving}
                                            className="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all flex items-center justify-center gap-2 disabled:opacity-50"
                                        >
                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                            </svg>
                                            Th√™m T·∫•t C·∫£
                                        </button>
                                    </div>
                                </div>

                                {/* Suggestions List */}
                                <div className="space-y-2 max-h-96 overflow-y-auto">
                                    {suggestions[activeTab].length === 0 ? (
                                        <p className="text-center text-gray-500 py-8">
                                            Ch∆∞a c√≥ g·ª£i √Ω n√†o. Th√™m g·ª£i √Ω ƒë·∫ßu ti√™n!
                                        </p>
                                    ) : (
                                        suggestions[activeTab].map((suggestion, index) => (
                                            <div
                                                key={index}
                                                className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-all"
                                            >
                                                <span className="text-gray-600 font-medium mt-1">
                                                    {index + 1}.
                                                </span>
                                                <p className="flex-1 text-gray-800">{suggestion}</p>
                                                <button
                                                    onClick={() => deleteSuggestion(index)}
                                                    disabled={saving}
                                                    className="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-all disabled:opacity-50"
                                                >
                                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                    </svg>
                                                </button>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
